/*
  ---------------------------------------------------------------------------
  Reflow Master Control - v1.0.0 - 01/07/2018

  AUTHOR/LICENSE:
  Created by Seon Rozenblum - seon@unexpectedmaker.com
  Copyright 2016 License: GNU GPL v3 http://www.gnu.org/licenses/gpl-3.0.html

  LINKS:
  Project home: github.com/unexpectedmaker/reflowmaster
  Blog: unexpectedmaker.com

  DISCLAIMER:
  This software is furnished "as is", without technical support, and with no
  warranty, express or implied, as to its usefulness for any purpose.

  PURPOSE:
  This is the profile structure used by the Reflow Master toaster oven controller made by Unexpected Maker

  HISTORY:
  01/08/2018 v1.0 - Initial release.
  20/05/2019 v1.04 - Increased max curve to support profiles up to 8mins
  19/12/2020 v2.00 - Simplified constructor and initialisation

  ---------------------------------------------------------------------------
  Each profile is initialised with the follow data:

      Paste name ( String )
      Paste type ( String )
      Paste Reflow Temperature ( int )
      Profile graph X values - time
      Profile graph Y values - temperature
      Size of the time array
*/
#define ELEMENTS(x)   (sizeof(x) / sizeof(x[0]))

class ReflowGraph
{

  public:
    String n;
    String t;
    int tempDeg;
    float reflowTime[10];
    float reflowTemp[10];
    float reflowTangents[10] { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 };
    float wantedCurve[480];
    int len = -1;
    int fanTime = -1;
    int offTime = -1;
    int completeTime = -1;

    float maxWantedDelta = 0;

    ReflowGraph()
    {
    }

    ReflowGraph(String nm, String tp, int temp, float flowX[], float flowY[], int arraySize )
    {
      n = nm;
      t = tp;
      tempDeg = temp;

      len = min( 10, arraySize );

      Serial.print( nm );
      Serial.print(" len? ");
      Serial.println(len);

      fanTime = flowX[ len - 3 ];
      offTime = flowX[ len - 2 ];
      completeTime = flowX[ len - 1 ];

      for ( int i = 0; i < len; i++ )
      {
        reflowTime[i] = flowX[i];
        reflowTemp[i] = flowY[i];

        if ( i == 0 )
          reflowTangents[i] = 1;
        else if ( i >= fanTime )
          reflowTangents[i] = 1;
        else
          reflowTangents[i] = 0;
      }

      for ( int i = 0; i < ELEMENTS(wantedCurve); i++ )
        wantedCurve[i] = -1;
    }

    ~ReflowGraph()
    {
    }

    float MaxTempValue()
    {
      float maxV = -1;
      for ( int i = 0; i < len; i++ )
        maxV = max( maxV, reflowTemp[i] );

      return maxV;
    }

    float MinTempValue()
    {
      float minV = 1000;
      for ( int i = 0; i < len; i++ )
      {
        if ( reflowTemp[i] > 0 )
          minV = min( minV, reflowTemp[i] );
      }

      return minV;
    }

    float MaxTime()
    {
      float maxV = -1;
      for ( int i = 0; i < len; i++ )
        maxV = max( maxV, reflowTime[i] );

      return maxV;
    }
};


/*
   End ReflowGraphs
*/


const uint8_t PROGMEM UM_Logo[] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xfc, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 
0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x3f, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xf8, 0x00, 0x3f, 0xc0, 0x7f, 0xfc, 0x03, 0xc1, 0xff, 0xfe, 0x1f, 0xff, 0xf8, 0x00, 
0x3f, 0x80, 0x7f, 0xfc, 0x00, 0x00, 0x3f, 0xe0, 0x01, 0xff, 0xfc, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 
0x00, 0x00, 0x0f, 0x80, 0x00, 0x7f, 0xfe, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x00, 0x00, 0x03, 0x00, 
0x00, 0x1f, 0xfe, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xfe, 0x00, 
0x3f, 0x80, 0x7f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x00, 0x3c, 0x00, 0x01, 
0xe0, 0x03, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x00, 0xff, 0x00, 0x07, 0xf8, 0x03, 0xff, 0x00, 
0x3f, 0x80, 0x7f, 0xfc, 0x01, 0xff, 0x80, 0x0f, 0xfc, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 
0x01, 0xff, 0xc0, 0x0f, 0xfe, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xc0, 0x1f, 
0xfe, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 0xfe, 0x01, 0xff, 0x00, 
0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 0xfe, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 
0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 
0xff, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 
0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 
0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 
0xff, 0x01, 0xff, 0x00, 0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 
0x3f, 0x80, 0x7f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0xc0, 0x7f, 0xfc, 
0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0xc0, 0x3f, 0xfc, 0x03, 0xff, 0xe0, 0x1f, 
0xff, 0x01, 0xff, 0x00, 0x3f, 0xc0, 0x3f, 0xf8, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 
0x3f, 0xc0, 0x1f, 0xf8, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0xc0, 0x0f, 0xf0, 
0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x3f, 0xe0, 0x03, 0x80, 0x03, 0xff, 0xe0, 0x1f, 
0xff, 0x01, 0xff, 0x00, 0x3f, 0xe0, 0x00, 0x00, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 
0x3f, 0xf0, 0x00, 0x00, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x1f, 0xf8, 0x00, 0x00, 
0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x1f, 0xfc, 0x00, 0x00, 0x03, 0xff, 0xe0, 0x1f, 
0xff, 0x01, 0xff, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 
0x0f, 0xff, 0xc0, 0x00, 0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x07, 0xff, 0xfe, 0xfc, 
0x03, 0xff, 0xe0, 0x1f, 0xff, 0x01, 0xff, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 
0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x1f, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
